{% extends "base.html" %}

{% block title %}Webhook Manager{% endblock %}

{% block content %}
<h1>üîó Webhook Manager</h1>

<div class="card">
    <h2>Current Webhook Status</h2>

    {% if webhook_info %}
    <table>
        <thead>
            <tr>
                <th>Property</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>URL</strong></td>
                <td>
                    {% if webhook_info.url %}
                    <code>{{ webhook_info.url }}</code>
                    {% else %}
                    <span style="color: #64748b;">Not set (polling mode)</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td><strong>Has Custom Certificate</strong></td>
                <td>{{ '‚úÖ Yes' if webhook_info.has_custom_certificate else '‚ùå No' }}</td>
            </tr>
            <tr>
                <td><strong>Pending Updates</strong></td>
                <td><strong>{{ webhook_info.pending_update_count or 0 }}</strong></td>
            </tr>
            {% if webhook_info.last_error_date %}
            <tr>
                <td><strong>Last Error</strong></td>
                <td style="color: var(--danger);">{{ webhook_info.last_error_message }}</td>
            </tr>
            {% endif %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #64748b;">No webhook information available</p>
    {% endif %}
</div>

<div class="card">
    <h2>Webhook Actions</h2>

    <form method="POST" style="margin-bottom: 1rem;">
        <input type="hidden" name="action" value="set">
        <div class="form-group">
            <label for="webhook_url">Set Webhook URL</label>
            <input type="text" id="webhook_url" name="webhook_url" placeholder="https://your-domain.com/webhook"
                required>
        </div>
        <button type="submit" class="btn-success">üîó Set Webhook</button>
    </form>

    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        <form method="POST" style="display: inline;">
            <input type="hidden" name="action" value="delete">
            <button type="submit" class="btn-danger">üóëÔ∏è Delete Webhook</button>
        </form>

        <form method="POST" style="display: inline;">
            <input type="hidden" name="action" value="fix">
            <button type="submit" class="btn-secondary">üîß Fix (Switch to Polling)</button>
        </form>
    </div>
</div>

<div class="alert alert-info">
    ‚ÑπÔ∏è <strong>Info:</strong> Webhooks allow Telegram to push updates to your server. If you're not using webhooks, the
    bot will use polling mode to fetch updates.
</div>
{% endblock %}